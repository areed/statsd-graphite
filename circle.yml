machine:
  services:
    - docker
  environment:
    STATSD_GRAPHITE_TAG: 0.1.0

checkout:
  post:
    - mkdir -p $HOME/src/github.com/replicatedcom
    - cp -r $HOME/statsd-graphite $HOME/src/github.com/replicatedcom/statsd-graphite

deployment:
  docker:
    branch: master
    owner: replicated
    commands:
      - cd $HOME/src/github.com/replicatedcom/statsd-graphite
      - sudo docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - sudo docker build -t replicated/statsd-graphite:latest .
      - sudo docker tag replicated/statsd-graphite:$STATSD_GRAPHITE_TAG replicated/statsd-graphite:latest
      - sudo docker push replicated/statsd-graphite:latest
      - sudo docker push replicated/statsd-graphite:$STATSD_GRAPHITE_TAG
